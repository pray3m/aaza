//
//  NepaliCalendar.swift - Calendar data (2000-2090)
//  aaza
//
//  Created by Prem Gautam on 8/2/2026.
//

import Foundation

// Calendar data from nepalical/BsData.h (https://github.com/nepali-bhasa/nepali-calendar)
struct NepaliCalendar{
    static let minYear = 2000
    static let maxYear = 2090
    
    // Row index = year - 2000, columns = 12 months + total days
    static let calendarData: [[Int]] = [
           [30,32,31,32,31,30,30,30,29,30,29,31,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,31,32,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [30,32,31,32,31,30,30,30,29,30,29,31,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,31,32,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [31,31,31,32,31,31,29,30,30,29,29,31,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,31,32,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [31,31,31,32,31,31,29,30,30,29,30,30,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,31,32,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [31,31,31,32,31,31,29,30,30,29,30,30,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,30,29,31,366],
           [31,31,31,32,31,31,30,29,30,29,30,30,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,30,29,31,366],
           [31,31,31,32,31,31,30,29,30,29,30,30,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [30,32,31,32,31,30,30,30,29,30,29,31,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,31,32,31,32,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [30,32,31,32,31,30,30,30,29,30,29,31,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,31,32,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [30,32,31,32,31,31,29,30,30,29,29,31,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,31,32,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [31,31,31,32,31,31,29,30,30,29,30,30,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,31,32,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [31,31,31,32,31,31,29,30,30,29,30,30,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [31,31,31,32,31,31,30,29,30,29,30,30,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,30,29,31,366],
           [31,31,31,32,31,31,30,29,30,29,30,30,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,30,29,31,366],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,31,32,31,32,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [30,32,31,32,31,30,30,30,29,30,29,31,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,31,32,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [30,32,31,32,31,31,29,30,29,30,29,31,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,31,32,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [31,31,31,32,31,31,29,30,30,29,29,31,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,31,32,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [31,31,31,32,31,31,29,30,30,29,30,30,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,31,366],
           [31,31,31,32,31,31,30,29,30,29,30,30,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,30,29,31,366],
           [31,31,31,32,31,31,30,29,30,29,30,30,365],
           [31,31,32,31,31,31,30,29,30,29,30,30,365],
           [31,32,31,32,31,30,30,30,29,29,30,30,365],
           [31,31,32,32,31,30,30,30,29,30,30,30,366],
           [30,32,31,32,31,30,30,30,29,30,30,30,365],
           [31,31,32,31,31,30,30,30,29,30,30,30,365],
           [31,31,32,31,31,30,30,30,29,30,30,30,365],
           [31,32,31,32,30,31,30,30,29,30,30,30,366],
           [30,32,31,32,31,30,30,30,29,30,30,30,365],
           [31,31,32,31,31,31,30,30,29,30,30,30,366],
           [30,31,32,32,30,31,30,30,29,30,30,30,365],
           [30,32,31,32,31,30,30,30,29,30,30,30,365],
           [30,32,31,32,31,30,30,30,29,30,30,30,365]
       ]
    
    static func isSupported(year:Int)-> Bool {
        (minYear...maxYear).contains(year)
    }
    
    static func daysInMonth(year:Int,month:Int) -> Int? {
        guard isSupported(year: year), (1...12).contains(month) else { return nil}
        return calendarData[year-minYear][month-1]
    }
    
    static func serial(of date: NepaliDate) -> Int? {
          guard let maxDay = daysInMonth(year: date.year, month: date.month),
                (1...maxDay).contains(date.day) else { return nil }

          var total = 0
          for y in minYear..<date.year {
              total += calendarData[y - minYear][12]
          }
          for m in 1..<date.month {
              total += calendarData[date.year - minYear][m - 1]
          }
          total += (date.day - 1)
          return total
      }
    
    static func date(fromSerial serial: Int) -> NepaliDate? {
           guard serial >= 0 else { return nil }

           var remaining = serial
           var year = minYear

           while year <= maxYear {
               let yearDays = calendarData[year - minYear][12]
               if remaining < yearDays { break }
               remaining -= yearDays
               year += 1
           }

           guard year <= maxYear else { return nil }

           var month = 1
           while month <= 12 {
               let monthDays = calendarData[year - minYear][month - 1]
               if remaining < monthDays { break }
               remaining -= monthDays
               month += 1
           }

           guard month <= 12 else { return nil }
           return NepaliDate(day: remaining + 1, month: month, year: year)
       }
}
